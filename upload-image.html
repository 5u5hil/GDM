<!DOCTYPE html>
<html>
    <head>
        <title>Good Deed Marathon</title> 

        <meta http-equiv="content-type" content="text/html;charset=iso-8859-1" />
        <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="msapplication-tap-highlight" content="no">
        <script type="text/javascript" src="js/main.js"></script>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script src="phonegap.js"></script>
        <script src="cdv-plugin-fb-connect.js"></script>
        
        <script src="facebook-js-sdk.js"></script>
		<link type="text/css" rel="stylesheet" href="css/docs.css" />
		<link type="text/css" rel="stylesheet" href="css/mmenu.css" />
        <link rel="stylesheet" href="chui/chui.android-3.0.4.min.css">
        <script src="chui/chocolatechip-3.0.4.min.js"></script>
        <script src="chui/chui-3.0.4.min.js"></script>
        <script src="jquery.iframeResizer.min.js"></script>
<script type="application/javascript">
$('iframe').iFrameSizer({
log: false,
contentWindowBodyMargin:0,
doHeight:true,
doWidth:false,
interval:250,
});
</script>

        <link type="text/css" rel="stylesheet" href="menu/mmenu.css" />
        <script type="text/javascript" src="menu/jquery.mmenu.min.js"></script>
                		

        <script>
               $(function() {
	       $('nav#menu').mmenu({
              dragOpen: true
           });
		});
            $(document).ready(function() {
                $("#formm").submit(function(e) {
                    e.preventDefault();
                    $.ajax({
                        url: "http://flyingcursor.com/GoodDeedMarathon/submit.php",
                        type: "POST",
                        data: $("#formm").serialize(),
                        success: function(data) {
                            var cont = data.split("==");
                            window.localStorage.setItem("city", cont[0]);
                            window.localStorage.setItem("state", cont[1]);
                            window.localStorage.setItem("phone", cont[2]);
                            window.localStorage.setItem("pin", cont[3]);
                            window.localStorage.setItem("address", cont[4]);
                            window.location.href = "thank-you.html";
                        }
                    });
                });

            });
        </script>
    </head>
    <body>
            <div id="main">
		<div id="page">
			<div id="header" style="background-color: #69be28;">
				<a href="#menu" style="padding-top: 14px;"></a>
				        <img src="images/gdmnavlogo.png" height="27" width="86" style="padding-top: 15px;">
			</div><center>
		        <button onclick="capturePhoto();">Capture Photo</button> <br>
        <button onclick="getPhoto(pictureSource.PHOTOLIBRARY);">From Photo Library</button><br>
        <button onclick="captureVideo();">Capture Video</button>
        <img style="display:none;width:60px;height:60px;" id="smallImage" src="" />
        <img style="display:none;" id="largeImage" src="" />

        <div id="status"></div>
        <div id="fb-root"></div>
        <script>

            var pictureSource;   // picture source
            var destinationType; // sets the format of returned value

            // Wait for device API libraries to load
            //
            document.addEventListener("deviceready", onDeviceReady, false);

            // device APIs are available
            //
            function onDeviceReady() {
                pictureSource = navigator.camera.PictureSourceType;
                destinationType = navigator.camera.DestinationType;
            }

            // Called when a photo is successfully retrieved
            //

            function captureSuccess(mediaFiles) {
                var i, len;
                for (i = 0, len = mediaFiles.length; i < len; i += 1) {
                    uploadFile(mediaFiles[i]);
                }
            }

            // Called if something bad happens.
            //
            function captureError(error) {
                var msg = 'An error occurred during capture: ' + error.code;
                navigator.notification.alert(msg, null, 'Uh oh!');
            }

            // A button will call this function
            //
            function captureVideo() {
                // Launch device video recording application,
                // allowing user to capture up to 2 video clips
                navigator.device.capture.captureVideo(captureSuccess, captureError, {duration: 15});
            }

            // Upload files to server
            function uploadFile(mediaFile) {
                var ft = new FileTransfer(),
                        path = mediaFile.fullPath,
                        name = userid + "_" + Number(new Date()) + ".mp4";
ft.onprogress = function(progressEvent) {
                    $("#status").show();
                    if (progressEvent.lengthComputable) {
                        var perc = Math.floor(progressEvent.loaded / progressEvent.total * 100);
                        statusDom.innerHTML = perc + "% loaded...";
                    } else {
                        if (statusDom.innerHTML == "") {
                            statusDom.innerHTML = "Loading";
                        } else {
                            statusDom.innerHTML += ".";
                        }
                    }
                };
                ft.upload(path,
                        "http://flyingcursor.com/GoodDeedMarathon/upload.php",
                        function(result) {
                            console.log('Upload success: ' + result.responseCode);
                            console.log(result.bytesSent + ' bytes sent');
                             $("#status").hide();
                        },
                        function(error) {
                            console.log('Error uploading file ' + path + ': ' + error.code);
                        },
                        {fileName: name});
            }
            function onPhotoDataSuccess(imageData) {
                // Uncomment to view the base64-encoded image data
                // console.log(imageData);

                // Get image handle
                //
                var smallImage = document.getElementById('smallImage');

                // Unhide image elements
                //
                smallImage.style.display = 'block';

                // Show the captured photo
                // The inline CSS rules are used to resize the image
                //
                smallImage.src = "data:image/jpeg;base64," + imageData;
            }

            // Called when a photo is successfully retrieved
            //
            function onPhotoURISuccess(imageURI) {

                var options = new FileUploadOptions();
                options.fileKey = "file";
                var userid = window.localStorage.getItem("id");
                var imagefilename = userid + "_" + Number(new Date()) + ".jpg";
                options.fileName = imagefilename;
                options.mimeType = "image/jpg";

                var params = new Object();
                params.imageURI = imageURI;
                params.userid = sessionStorage.loginuserid;
                options.params = params;
                options.chunkedMode = false;
                var ft = new FileTransfer();
                var url = "http://flyingcursor.com/GoodDeedMarathon/upload.php";

                var statusDom = document.querySelector('#status');
                ft.onprogress = function(progressEvent) {
                    $("#status").show();
                    if (progressEvent.lengthComputable) {
                        var perc = Math.floor(progressEvent.loaded / progressEvent.total * 100);
                        statusDom.innerHTML = perc + "% loaded...";
                    } else {
                        if (statusDom.innerHTML == "") {
                            statusDom.innerHTML = "Loading";
                        } else {
                            statusDom.innerHTML += ".";
                        }
                    }
                };
                ft.upload(imageURI, url, win, fail, options, true);


            }

            // A button will call this function
            //
            function capturePhoto() {
                // Take picture using device camera and retrieve image as base64-encoded string
                navigator.camera.getPicture(onPhotoURISuccess, onFail, {quality: 50,
                    destinationType: destinationType.FILE_URI});
            }

            // A button will call this function
            //
            function capturePhotoEdit() {
                // Take picture using device camera, allow edit, and retrieve image as base64-encoded string
                navigator.camera.getPicture(onPhotoURISuccess, onFail, {quality: 20, allowEdit: true,
                    destinationType: destinationType.FILE_URI});
            }

            // A button will call this function
            //
            function getPhoto(source) {
                // Retrieve image file location from specified source
                navigator.camera.getPicture(onPhotoURISuccess, onFail, {quality: 50,
                    destinationType: destinationType.FILE_URI,
                    sourceType: source});
            }

            // Called if something bad happens.
            //
            function onFail(message) {
                alert('Failed because: ' + message);
            }
            function win(r) {
                $("#status").hide();
                alert("Image uploaded successfully!!");
            }
//Failure callback
            function fail(error) {
                alert(error);
            }
// Called if something bad happens.
// 

        </script>
        <div id="log"></div>
        <div id="log"></div>
        <nav id="menu">
				<ul>
					<li><a href="page.html">Gallery</a></li>
					<li class="Selected"><a href="mainmenu.html">About</a></li>
					<li><a href="submenus.html">Uploads</a></li>
					<li><a href="labels.html"></a></li>
	
				</ul>
			</nav>
		</div>
        </div>

    </body>
</html>