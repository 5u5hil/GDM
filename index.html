<!DOCTYPE html>
<html>
    <head>
        <title>Good Deed Marathon</title>

        <meta http-equiv="content-type" content="text/html;charset=iso-8859-1" />
        <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="msapplication-tap-highlight" content="no">

        <link rel="stylesheet" type="text/css" href="style.css" />
        <link rel="stylesheet" type="text/css" href="css/owl.carousel.css" />
        <link rel="stylesheet" type="text/css" href="css/owl.theme.css" />

        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>   
        <script src="js/modernizr.custom.js"></script>
        <script src="phonegap.js"></script>
        <script src="cdv-plugin-fb-connect.js"></script>
        <script src="facebook-js-sdk.js"></script>
        <script src="js/owl.carousel.min.js"></script>
        <script src="js/plugins/SocialSharing.js"></script>
        <script src="GAPlugin.js"></script>
    </head>
    <body>
        <div id="st-container" class="st-container">
            <nav class="st-menu st-effect-13" id="menu-13">
                <ul>
                    <li><a class="icon icon-home" href="index.html">Home</a></li>
                    <li><a class="icon icon-submit" href="submit.html">Submit a Deed</a></li>
                    <li><a class="icon icon-goodDeed" href="gallery.html">Gallery</a></li>
                    <li><a class="icon icon-map" href="map.html">Map</a></li>
                    <li><a class="icon icon-prizes" href="rewards.html">Goodies</a></li>
                    <li><a class="icon icon-partner" href="partners.html">Partners</a></li>
                    <li><a class="icon icon-initiatives" href="justin.html">Just In!</a></li>
                </ul>
            </nav>
            <div class="st-pusher">
                <div class="st-content">
                    <div class="st-content-inner">
                        <header>
                            <p class="left-menu"><a href="#" data-effect="st-effect-13" id="trigger" class="menu-trigger">Open/Close Menu</a></p>
                            <p style="text-align: center; margin: 0; padding: 0;"><img src="images/gdm_logo.png" width="129" height="50" /></p>
                        </header>
                        <div id="home" class="content center-align">
                            <div class="reg">
                                <div id="data">loading ...</div>
                                <div style="height: 30px;"></div>
                                <p class="color-green">
                                    The Good Deed Marathon<br />
                                    is about to make Mumbai a shiny happy city.<br />
                                    See for yourself.
                                </p>
                                <div style="height: 30px;"></div>
                                <div id="logginn">
                                    <p class="color-blue">
                                        Connect with Facebook to join in.
                                    </p>
                                    <img src="images/fb_login.png" width="206" height="49" onclick="login();" />
                                </div>
                                <div style="height: 30px;"></div>

                                <div class='youtubeGallery' style="width: 300px; height: 225px; margin: 0 auto;">
                                </div>

                            </div>       
                            <div id="formie" style="display: none;">
                                <p class="color-blue">
                                    We just need a few more details. <br />
                                    Fill them in to share your good deeds with everyone <br />
                                    and see Mumbai dazzle!
                                </p>
                                <form id="formm">
                                    <p class="color-green errorMSG" style="display:none;font-size: 10px;text-align: right;">Oops! Please check your details again.</p>
                                    <input type="text" placeholder="Full Name*" name="name" id="name" class="text" tabindex="1"/>
                                    <input type="email" placeholder="Email ID*" name="email" id="email" class="text" tabindex="2" />
                                    <input type="hidden" name="dob" id="dob" class="text" />
                                    <input type="hidden" name="gender" id="gender" class="text" />
                                    <input type="text" name="city" id="city" placeholder="City*" class="text" value="Mumbai" disabled="disabled"/>
                                    <input type="text" name="state" id="state" placeholder="State*" class="text"  value="Maharashtra" disabled="disabled"/> 
                                    <input type="text" name="pin" id="pin" placeholder="Zip Code*" class="text" tabindex="3"/>
                                    <input type="text" name="phn" id="phn" placeholder="Mobile Number*" class="text" tabindex="4" />
                                    <input type="hidden" name="prof_id" id="prof_id" />
                                    <textarea name="address" id="address"  class="text" placeholder="Full Address*" tabindex="5"></textarea>
                                    <input type="image" src="images/submit.jpg" id="submitie" tabindex="6" />
                                </form>
                            </div>
                            <div style="height: 60px;"></div>
                            <a href="#" onclick="window.plugins.socialsharing.share('I\'m all set to make Mumbai a shiny happy place. Want to join in? Register for the Good Deed Marathon here! ', null, null, 'http://bit.ly/1bqAJBL')">  <img src="images/ty-spread-the-love.png"  style="width: 50%;margin-bottom: 10px;" /> </a>

                        </div><!--home ends here-->
                    </div><!--st-content-inner ends here-->
                </div><!--.st-content ends here-->
            </div>
        </div><!--st-container ends here-->
        <script src="js/classie.js"></script>
        <script src="js/sidebarEffects.js"></script>
        <script>
                                        var gaPlugin;
                                        var error = 0;
                                        $(document).ready(function() {
                                            var owl = $(".youtubeGallery").owlCarousel({
                                                navigation: false, // Show next and prev buttons
                                                slideSpeed: 300,
                                                paginationSpeed: 400,
                                                singleItem: true,
                                                touchDrag: true

                                            });


                                            $.ajax({
                                                url: "http://www.gooddeedmarathon.com/getYoutubeVideo.php",
                                                success: function(data) {
                                                    owl.data('owlCarousel').addItem(data, 0);
                                                }
                                            });


                                            $("#submitie").click(function(e) {
                                                error = 0;
                                                e.preventDefault();
                                                $(".errorMSG").hide();
                                                $(".text").removeClass("errorBorder");
                                                $(".text").each(function() {
                                                    if ($(this).val() == "") {
                                                        $(this).addClass("errorBorder");
                                                        error = 1;
                                                        $(".errorMSG").show();
                                                    }
                                                });
                                                if (error == 0) {
                                                    $.ajax({
                                                        url: "http://www.gooddeedmarathon.com/submitAndroid.php",
                                                        type: "POST",
                                                        data: $("#formm").serialize(),
                                                        success: function(data) {
                                                            var cont = data.split("==");
                                                            window.localStorage.setItem("city", cont[0]);
                                                            window.localStorage.setItem("state", cont[1]);
                                                            window.localStorage.setItem("phone", cont[2]);
                                                            window.localStorage.setItem("pin", cont[3]);
                                                            window.localStorage.setItem("address", cont[4]);
                                                            window.location.href = "thank-you.html";
                                                        }
                                                    });
                                                }
                                            });

                                        });
        </script>
        <script>
            function login() {
                FB.login(
                        function(response) {

                            FB.api('/me', function(response) {
                                if (response.error) {
                                    //alert(JSON.stringify(response.error));
                                } else {
                                    window.localStorage.setItem("id", response.id);
                                    window.localStorage.setItem("name", response.name);
                                    window.localStorage.setItem("email", response.email);
                                    window.localStorage.setItem("birthday", response.birthday);
                                    window.localStorage.setItem("gender", response.gender);
                                    checkie();

                                }
                            });
                        },
                        {scope: "email,user_birthday,publish_actions"}
                );
            }

            document.addEventListener('deviceready', function() {
                gaPlugin = window.plugins.gaPlugin;
                gaPlugin.init(nativePluginResultHandler, nativePluginErrorHandler, "UA-12345678-1", 10);
                try {
                    FB.init({appId: "622986024390860", nativeInterface: CDV.FB, useCachedDialogs: false});
                    document.getElementById('data').innerHTML = "";
                } catch (e) {
                    //   alert(e);
                }
                if (window.localStorage.getItem("city") != null && window.localStorage.getItem("state") != null && window.localStorage.getItem("phone") != null && window.localStorage.getItem("pin") != null && window.localStorage.getItem("address") != null && window.localStorage.getItem("id") != null && window.localStorage.getItem("name") != null && window.localStorage.getItem("email") != null) {
                    $("#logginn").hide();
                } else if (window.localStorage.getItem("id") != null && window.localStorage.getItem("name") != null && window.localStorage.getItem("email") != null && window.localStorage.getItem("birthday") != null) {
                    switchie();
                }

            }, false);
            function nativePluginResultHandler(result) {
                //alert('nativePluginResultHandler - '+result);
                console.log('nativePluginResultHandler: ' + result);

            }

            function nativePluginErrorHandler(error) {
                //alert('nativePluginErrorHandler - '+error);
                console.log('nativePluginErrorHandler: ' + error);
            }
            function switchie() {
                $("#prof_id").val(window.localStorage.getItem("id"));
                $("#name").val(window.localStorage.getItem("name"));
                $("#email").val(window.localStorage.getItem("email"));
                $("#dob").val(window.localStorage.getItem("birthday"));
                $("#gender").val(window.localStorage.getItem("gender"));
                $("#logginn").hide();
                $(".reg").hide();
                $("#formie").show();
            }
            function  checkie() {
                $.ajax({
                    url: "http://www.gooddeedmarathon.com/check.php",
                    type: "POST",
                    data: {prof_id: window.localStorage.getItem("id")},
                    success: function(data) {

                        if (data == 0) {
                            switchie();
                        } else {
                            var cont = data.split("==");
                            window.localStorage.setItem("city", cont[0]);
                            window.localStorage.setItem("state", cont[1]);
                            window.localStorage.setItem("phone", cont[2]);
                            window.localStorage.setItem("pin", cont[3]);
                            window.localStorage.setItem("address", cont[4]);
                            $("#logginn").hide();
                        }
                    }
                });

            }
        </script>
    </body>
</html>
